{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\category.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "indexAction",
        "model",
        "data",
        "where",
        "is_show",
        "order",
        "select",
        "topCategory",
        "filter",
        "item",
        "parent_id",
        "categoryList",
        "map",
        "level",
        "push",
        "title",
        "name",
        "id",
        "expand",
        "children",
        "child",
        "length",
        "success",
        "topCategoryAction",
        "secondCategoryAction",
        "storeAction",
        "isPost",
        "post",
        "parent",
        "update",
        "addAction",
        "max",
        "insertData",
        "keywords",
        "front_desc",
        "sort_order",
        "show_index",
        "banner_url",
        "icon_url",
        "img_url",
        "wap_banner_url",
        "type",
        "front_name",
        "add",
        "editAction",
        "destroyAction",
        "limit",
        "delete"
    ],
    "mappings": ";;AAAA,MAAMA,OAAOC,QAAQ,WAAR,CAAb;;AAEAC,OAAOC,OAAP,GAAiB,cAAcH,IAAd,CAAmB;AAClC;;;;AAIMI,aAAN,GAAoB;AAAA;;AAAA;AAClB,YAAMC,QAAQ,MAAKA,KAAL,CAAW,UAAX,CAAd;AACA,YAAMC,OAAO,MAAMD,MAAME,KAAN,CAAY,EAACC,SAAS,CAAV,EAAZ,EAA0BC,KAA1B,CAAgC,CAAC,gBAAD,CAAhC,EAAoDC,MAApD,EAAnB;AACA,YAAMC,cAAcL,KAAKM,MAAL,CAAY,UAACC,IAAD,EAAU;AACxC,eAAOA,KAAKC,SAAL,KAAmB,CAA1B;AACD,OAFmB,CAApB;AAGA,YAAMC,eAAe,EAArB;AACAJ,kBAAYK,GAAZ,CAAgB,UAACH,IAAD,EAAU;AACxBA,aAAKI,KAAL,GAAa,CAAb;AACAF,qBAAaG,IAAb,CAAkB,EAAEC,OAAMN,KAAKO,IAAL,GAAY,GAAZ,GAAkBP,KAAKQ,EAAvB,GAA4B,GAApC,EAAyCC,QAAQ,KAAjD,EAAwDC,UAAU,EAAlE,EAAlB;AACAjB,aAAKU,GAAL,CAAS,UAACQ,KAAD,EAAW;AAClB,cAAIA,MAAMV,SAAN,KAAoBD,KAAKQ,EAA7B,EAAiC;AAC/BG,kBAAMP,KAAN,GAAc,CAAd;AACAO,kBAAMV,SAAN,GAAkBD,KAAKO,IAAvB;AACAL,yBAAaA,aAAaU,MAAb,GAAoB,CAAjC,EAAoCF,QAApC,CAA6CL,IAA7C,CAAkD,EAAEC,OAAOK,MAAMJ,IAAN,GAAa,GAAb,GAAmBI,MAAMH,EAAzB,GAA8B,GAAvC,EAA4CC,QAAQ,KAApD,EAAlD;AACD;AACF,SAND;AAOD,OAVD;AAWA,aAAO,MAAKI,OAAL,CAAaX,YAAb,CAAP;AAlBkB;AAmBnB;;AAEKY,mBAAN,GAA0B;AAAA;;AAAA;AACxB,YAAMtB,QAAQ,OAAKA,KAAL,CAAW,UAAX,CAAd;AACA,YAAMC,OAAO,MAAMD,MAAME,KAAN,CAAY,EAACO,WAAW,CAAZ,EAAZ,EAA4BJ,MAA5B,EAAnB;;AAEA,aAAO,OAAKgB,OAAL,CAAapB,IAAb,CAAP;AAJwB;AAKzB;;AAEKsB,sBAAN,GAA6B;AAAA;;AAAA;AAC3B,YAAMvB,QAAQ,OAAKA,KAAL,CAAW,UAAX,CAAd;AACA,YAAMC,OAAO,MAAMD,MAAME,KAAN,CAAY,EAACO,WAAU,CAAC,IAAD,EAAM,CAAN,CAAX,EAAZ,EAAkCJ,MAAlC,EAAnB;AACA,aAAO,OAAKgB,OAAL,CAAapB,IAAb,CAAP;AAH2B;AAI5B;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEMuB,aAAN,GAAoB;AAAA;;AAAA;AAClB,UAAI,CAAC,OAAKC,MAAV,EAAkB;AAChB,eAAO,KAAP;AACD;;AAED,YAAMT,KAAK,OAAKU,IAAL,CAAU,IAAV,CAAX;AACA,YAAMd,QAAQ,OAAKc,IAAL,CAAU,OAAV,CAAd;AACA,YAAMC,SAAS,OAAKD,IAAL,CAAU,QAAV,CAAf;AACA,UAAGd,SAAS,CAAZ,EAAe;AACb,cAAM,OAAKZ,KAAL,CAAW,UAAX,EAAuBE,KAAvB,CAA6B,EAACc,IAAGA,EAAJ,EAA7B,EAAsCY,MAAtC,CAA6C,EAAChB,OAAM,MAAIA,KAAX,EAAiBH,WAAU,CAA3B,EAA7C,CAAN;AACD;AACD,UAAGG,SAAS,CAAZ,EAAe;AACb,cAAM,OAAKZ,KAAL,CAAW,UAAX,EAAuBE,KAAvB,CAA6B,EAACc,IAAGA,EAAJ,EAA7B,EAAsCY,MAAtC,CAA6C,EAACnB,WAAUkB,MAAX,EAA7C,CAAN;AACD;AACD;AACA;AACA,aAAO,OAAKN,OAAL,EAAP;AAhBkB;AAiBnB;;AAEKQ,WAAN,GAAkB;AAAA;;AAAA;AAChB,UAAI,CAAC,OAAKJ,MAAV,EAAkB;AAChB,eAAO,KAAP;AACD;AACD,YAAMT,KAAK,MAAM,OAAKhB,KAAL,CAAW,UAAX,EAAuB8B,GAAvB,CAA2B,IAA3B,CAAjB;AACA,YAAMf,OAAO,OAAKW,IAAL,CAAU,MAAV,CAAb;AACA,YAAMC,SAAS,OAAKD,IAAL,CAAU,QAAV,CAAf;AACA,UAAIK,aAAa,EAAjB;AACA,UAAGJ,UAAU,CAAb,EAAe;AACbI,qBAAa,EAACf,IAAIA,KAAG,CAAR,EAAWD,MAAKA,IAAhB,EAAqBiB,UAAS,EAA9B,EAAiCC,YAAW,EAA5C,EAA+CxB,WAAUkB,MAAzD,EAAgEO,YAAW,CAA3E,EAA6EC,YAAW,CAAxF,EAA0FhC,SAAQ,CAAlG,EAAoGiC,YAAW,mEAA/G,EAAmLC,UAAS,EAA5L,EAA+LC,SAAQ,EAAvM,EAA0MC,gBAAe,mEAAzN,EAA6R3B,OAAM,IAAnS,EAAwS4B,MAAK,CAA7S,EAA+SC,YAAW,EAA1T,EAAb;AACF,cAAM,OAAKzC,KAAL,CAAW,UAAX,EAAuB0C,GAAvB,CAA2BX,UAA3B,CAAN;AACAA,mBAAWnB,KAAX,GAAiB,CAAjB;AACC,OAJD,MAKI;AACFmB,qBAAa,EAACf,IAAIA,KAAG,CAAR,EAAWD,MAAKA,IAAhB,EAAqBiB,UAAS,EAA9B,EAAiCC,YAAW,EAA5C,EAA+CxB,WAAUkB,MAAzD,EAAgEO,YAAW,CAA3E,EAA6EC,YAAW,CAAxF,EAA0FhC,SAAQ,CAAlG,EAAoGiC,YAAW,mEAA/G,EAAmLC,UAAS,EAA5L,EAA+LC,SAAQ,EAAvM,EAA0MC,gBAAe,mEAAzN,EAA6R3B,OAAM,IAAnS,EAAwS4B,MAAK,CAA7S,EAA+SC,YAAW,EAA1T,EAAb;AACF,cAAM,OAAKzC,KAAL,CAAW,UAAX,EAAuB0C,GAAvB,CAA2BX,UAA3B,CAAN;AACA;AACC;AACD,aAAO,OAAKV,OAAL,CAAaU,UAAb,CAAP;AAlBgB;AAmBjB;;AAEKY,YAAN,GAAmB;AAAA;;AAAA;AACjB,UAAI,CAAC,OAAKlB,MAAV,EAAkB;AAChB,eAAO,KAAP;AACD;AACD,YAAMT,KAAK,OAAKU,IAAL,CAAU,IAAV,CAAX;AACA,YAAMX,OAAO,OAAKW,IAAL,CAAU,MAAV,CAAb;AACA,YAAM,OAAK1B,KAAL,CAAW,UAAX,EAAuBE,KAAvB,CAA6B,EAACc,IAAGA,EAAJ,EAA7B,EAAsCY,MAAtC,CAA6C,EAACb,MAAKA,IAAN,EAA7C,CAAN;AACA,aAAO,OAAKM,OAAL,EAAP;AAPiB;AAQlB;;AAEKuB,eAAN,GAAsB;AAAA;;AAAA;AACpB,YAAM5B,KAAK,OAAKU,IAAL,CAAU,IAAV,CAAX;AACA,YAAM,OAAK1B,KAAL,CAAW,UAAX,EAAuBE,KAAvB,CAA6B,EAACc,IAAIA,EAAL,EAA7B,EAAuC6B,KAAvC,CAA6C,CAA7C,EAAgDC,MAAhD,EAAN;AACA;;AAEA,aAAO,OAAKzB,OAAL,EAAP;AALoB;AAMrB;AA1GiC,CAApC",
    "file": "..\\..\\..\\src\\admin\\controller\\category.js",
    "sourcesContent": [
        "const Base = require('./base.js');\n\nmodule.exports = class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction() {\n    const model = this.model('category');\n    const data = await model.where({is_show: 1}).order(['sort_order ASC']).select();\n    const topCategory = data.filter((item) => {\n      return item.parent_id === 0;\n    });\n    const categoryList = [];\n    topCategory.map((item) => {\n      item.level = 1;\n      categoryList.push({ title:item.name + '(' + item.id + ')', expand: false, children: []});\n      data.map((child) => {\n        if (child.parent_id === item.id) {\n          child.level = 2;\n          child.parent_id = item.name;\n          categoryList[categoryList.length-1].children.push({ title: child.name + '(' + child.id + ')', expand: false});\n        }\n      });\n    });\n    return this.success(categoryList);\n  }\n\n  async topCategoryAction() {\n    const model = this.model('category');\n    const data = await model.where({parent_id: 0}).select();\n\n    return this.success(data);\n  }\n\n  async secondCategoryAction() {\n    const model = this.model('category');\n    const data = await model.where({parent_id:['!=',0]}).select();\n    return this.success(data);\n  }\n\n  // async infoAction() {\n  //   if (!this.isPost) {\n  //     return false;\n  //   }\n  //   const parent = this.post('parent');\n  //   const model = this.model('category');\n  //   const data = await model.where({parent_id: parent}).select();\n    \n  //   return this.success(data);\n  // }\n\n  async storeAction() {\n    if (!this.isPost) {\n      return false;\n    }\n\n    const id = this.post('id');\n    const level = this.post('level');\n    const parent = this.post('parent');\n    if(level == 1) {\n      await this.model('category').where({id:id}).update({level:'L'+level,parent_id:0});\n    }\n    if(level == 2) {\n      await this.model('category').where({id:id}).update({parent_id:parent})\n    }\n    // const updateObject = {};\n    // updateObject[key] = value;\n    return this.success();\n  }\n\n  async addAction() {\n    if (!this.isPost) {\n      return false;\n    }\n    const id = await this.model('category').max('id');\n    const name = this.post('name');\n    const parent = this.post('parent');\n    let insertData = {};\n    if(parent == 0){\n      insertData = {id:(id+1),name:name,keywords:'',front_desc:'',parent_id:parent,sort_order:1,show_index:1,is_show:1,banner_url:'http://yanxuan.nosdn.127.net/b60618db213322bdc2c5b1208655bd7e.png',icon_url:'',img_url:'',wap_banner_url:'http://yanxuan.nosdn.127.net/470a017f508e9a18f3068be7b315e14b.png',level:'L1',type:0,front_name:''};\n    await this.model('category').add(insertData);\n    insertData.level=1;\n    }\n    else{\n      insertData = {id:(id+1),name:name,keywords:'',front_desc:'',parent_id:parent,sort_order:1,show_index:1,is_show:1,banner_url:'http://yanxuan.nosdn.127.net/b60618db213322bdc2c5b1208655bd7e.png',icon_url:'',img_url:'',wap_banner_url:'http://yanxuan.nosdn.127.net/470a017f508e9a18f3068be7b315e14b.png',level:'L2',type:0,front_name:''};\n    await this.model('category').add(insertData);\n    //insertData.level=2;\n    }\n    return this.success(insertData);\n  }\n\n  async editAction() {\n    if (!this.isPost) {\n      return false;\n    }\n    const id = this.post('id');\n    const name = this.post('name');\n    await this.model('category').where({id:id}).update({name:name});\n    return this.success();\n  }\n\n  async destroyAction() {\n    const id = this.post('id');\n    await this.model('category').where({id: id}).limit(1).delete();\n    // TODO 删除图片\n\n    return this.success();\n  }\n};\n"
    ]
}