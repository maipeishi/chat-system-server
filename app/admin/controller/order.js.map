{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\order.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "indexAction",
        "page",
        "get",
        "size",
        "orderSn",
        "consignee",
        "model",
        "data",
        "where",
        "order_sn",
        "order",
        "countSelect",
        "newList",
        "item",
        "order_status_text",
        "getOrderStatusText",
        "id",
        "push",
        "success",
        "findAction",
        "orderdata",
        "think",
        "isEmpty",
        "post",
        "order_status",
        "select",
        "i",
        "length",
        "userid",
        "user_id",
        "orderid",
        "status",
        "username",
        "getField",
        "datainfo",
        "order_id",
        "shipper",
        "find",
        "order_price",
        "info",
        "express",
        "shipper_id",
        "expressName",
        "shipper_name",
        "expressAction",
        "isPost",
        "shippername",
        "storeAction",
        "values",
        "is_show",
        "is_new",
        "update",
        "add",
        "deliveryAction",
        "Number",
        "no",
        "max",
        "insertObject",
        "destroyAction"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\controller\\order.js",
    "sourcesContent": [
        "const Base = require('./base.js');\n\nmodule.exports = class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction() {\n    const page = this.get('page') || 1;\n    const size = this.get('size') || 10;\n    const orderSn = this.get('orderSn') || '';\n    const consignee = this.get('consignee') || '';\n\n    const model = this.model('order');\n    const data = await model.where({order_sn: ['like', `%${orderSn}%`], consignee: ['like', `%${consignee}%`]}).order(['id DESC']).page(page, size).countSelect();\n    const newList = [];\n    for (const item of data.data) {\n      item.order_status_text = await this.model('order').getOrderStatusText(item.id);\n      newList.push(item);\n    }\n    data.data = newList;\n    return this.success(data);\n  }\n\n  async findAction() {\n    let orderdata;\n    if (!think.isEmpty(this.post('stat'))) {\n      orderdata = await this.model('order').where({order_status:this.post('stat')}).select();\n    }\n    else {\n      orderdata = await this.model('order').select();\n    }\n    let data = [];\n    for(var i=0; i<orderdata.length; i++) {\n      const userid = orderdata[i].user_id;\n      const orderid = orderdata[i].order_sn;\n      let status = '';\n      const username = await this.model('user').where({id:userid}).getField('username');\n      if(orderdata[i].order_status == 1){\n        status = '未发货';\n      }\n      if(orderdata[i].order_status == 2){\n        status = '已发货';\n      }\n      if(orderdata[i].order_status == 3){\n        status = '订单已取消'\n      }\n      const datainfo = await this.model('order_goods').where({order_id:orderid}).select();\n      const shipper = await this.model('order_express').where({order_id:orderid}).find();\n      data[i] = {id: orderid,username:username[0],order_price:orderdata[i].order_price,order_status:orderdata[i].order_status,status:status,info:datainfo,express:shipper.shipper_id,expressName:shipper.shipper_name};\n    }\n    return this.success(data);\n  }\n\n  async expressAction() {\n    if (!this.isPost) {\n      return false;\n    }\n    const shippername = await this.model('shipper').getField('name');\n    return this.success(shippername);\n  }\n\n  async storeAction() {\n    if (!this.isPost) {\n      return false;\n    }\n\n    const values = this.post();\n    const id = this.post('id');\n\n    const model = this.model('order');\n    values.is_show = values.is_show ? 1 : 0;\n    values.is_new = values.is_new ? 1 : 0;\n    if (id > 0) {\n      await model.where({id: id}).update(values);\n    } else {\n      delete values.id;\n      await model.add(values);\n    }\n    return this.success(values);\n  }\n\n  async deliveryAction() {\n    if (!this.isPost||!Number(this.post('No'))) {\n      return false;\n    }\n    const orderid = this.post('id');\n    const no = this.post('No');\n    const shipper_name = this.post('express')\n    let id = await this.model('order_express').max('id');\n    if(id == null){\n      id = 1;\n    }\n    const insertObject = {id:(id+1),order_id:orderid,shipper_id:Number(no),shipper_name:shipper_name};\n    await this.model('order_express').add(insertObject);\n    await this.model('order').where({id: orderid}).update({order_status:2});\n    return this.success(insertObject);\n  }\n\n  async destroyAction() {\n    if (!this.isPost) {\n      return false;\n    }\n    const id = this.post('id');\n    await this.model('order').where({id: id}).update({order_status:0});\n\n    return this.success();\n  }\n};\n"
    ]
}