{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\admin\\controller\\goods.js"
    ],
    "names": [
        "Base",
        "require",
        "fs",
        "module",
        "exports",
        "indexAction",
        "page",
        "get",
        "size",
        "name",
        "model",
        "data",
        "where",
        "order",
        "countSelect",
        "success",
        "infoAction",
        "id",
        "find",
        "storeAction",
        "isPost",
        "values",
        "post",
        "is_on_sale",
        "is_new",
        "is_hot",
        "update",
        "add",
        "goodsAction",
        "CurrentPage",
        "goods",
        "Number",
        "length",
        "i",
        "goodsID",
        "CategoryID",
        "category_id",
        "classification",
        "storeandprice",
        "goods_id",
        "PicPath",
        "primary_pic_url",
        "Classification",
        "price",
        "retail_price",
        "unit",
        "goods_unit",
        "store",
        "goods_number",
        "pic",
        "totalPages",
        "AllGoodsAction",
        "select",
        "addAction",
        "categoryID",
        "remark",
        "max",
        "productID",
        "insertData",
        "goods_sn",
        "toString",
        "brand_id",
        "keywords",
        "goods_brief",
        "goods_desc",
        "add_time",
        "sort_order",
        "is_delete",
        "attrbute_category",
        "counter_price",
        "extra_pricd",
        "list_pic_url",
        "sell_volume",
        "primary_product_id",
        "unit_price",
        "promotion_desc",
        "promotion_tag",
        "app_exclusive_price",
        "is_app_exclusive",
        "is_limited",
        "insertData1",
        "goods_specification_ids",
        "insertId",
        "insertId1",
        "data1",
        "categoryName",
        "editAction",
        "key",
        "value",
        "updateObject",
        "affectedRows",
        "destroyAction",
        "ids",
        "think",
        "isEmpty",
        "limit",
        "delete"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\admin\\controller\\goods.js",
    "sourcesContent": [
        "const Base = require('./base.js');\nconst fs = require('fs');\n\nmodule.exports = class extends Base {\n  /**\n   * index action\n   * @return {Promise} []\n   */\n  async indexAction() {\n    const page = this.get('page') || 1;\n    const size = this.get('size') || 10;\n    const name = this.get('name') || '';\n\n    const model = this.model('goods');\n    const data = await model.where({name: ['like', `%${name}%`]}).order(['id DESC']).page(page, size).countSelect();\n\n    return this.success(data);\n  }\n\n  async infoAction() {\n    const id = this.get('id');\n    const model = this.model('goods');\n    const data = await model.where({id: id}).find();\n\n    return this.success(data);\n  }\n\n  async storeAction() {\n    if (!this.isPost) {\n      return false;\n    }\n\n    const values = this.post();\n    const id = this.post('id');\n\n    const model = this.model('goods');\n    values.is_on_sale = values.is_on_sale ? 1 : 0;\n    values.is_new = values.is_new ? 1 : 0;\n    values.is_hot = values.is_hot ? 1 : 0;\n    if (id > 0) {\n      await model.where({id: id}).update(values);\n    } else {\n      delete values.id;\n      await model.add(values);\n    }\n    return this.success(values);\n  }\n\n  async goodsAction() {\n    const CurrentPage = this.get('data');\n    // const goods = await this.model('goods').select();\n    const goods = await this.model('goods').page(Number(CurrentPage),30).countSelect();\n    const data=[goods.data.length];\n    for(var i=0; i<goods.data.length; i++){\n      const goodsID = goods.data[i].id;\n      const CategoryID = goods.data[i].category_id;\n      const classification = await this.model('category').where({id:CategoryID}).find();\n      const storeandprice = await this.model('product').where({goods_id:goodsID}).find();\n      const PicPath = goods.data[i].primary_pic_url;\n      \n      data[i] = {id:goods.data[i].id, name:goods.data[i].name, Classification:classification.name, price:storeandprice.retail_price, unit:goods.data[i].goods_unit,store:storeandprice.goods_number,pic:PicPath};\n    }\n\n    return this.success({data:data,totalPages:goods.totalPages});\n  }\n\n  // 导出excel用\n  async AllGoodsAction() {\n    const goods = await this.model('goods').select();\n    const data=[goods.length];\n    for(var i=0; i<goods.length; i++){\n      const goodsID = goods[i].id;\n      const CategoryID = goods[i].category_id;\n      const classification = await this.model('category').where({id:CategoryID}).find();\n      const storeandprice = await this.model('product').where({goods_id:goodsID}).find();\n      data[i] = {id:goods[i].id, name:goods[i].name, Classification:classification.name, price:storeandprice.retail_price, unit:goods[i].goods_unit,store:storeandprice.goods_number};\n    }\n    return this.success(data);\n  }\n\n  async addAction() {\n    if (!this.isPost) {\n      return false;\n    }\n    const categoryID = this.post('id');\n    const name = this.post('name');\n    const price = this.post('price');\n    const store = this.post('store');\n    const unit = this.post('unit');\n    const remark = this.post('remark');\n    const pic = this.post('pic');\n\n    const model = this.model('goods');\n    const id = await model.max('id');\n    const productID = await this.model('product').max('id');\n    const insertData = {id:(id+1),category_id: categoryID, goods_sn: (id+1).toString(),name:name,brand_id:0,goods_number:100,keywords:' ',goods_brief:remark,goods_desc:' ',is_on_sale:1,add_time:0,sort_order:2,is_delete:0,attrbute_category:0,counter_price:0.00,extra_pricd:0.00,is_new:0,goods_unit:unit,primary_pic_url:pic,list_pic_url:pic,retail_price:Number(price),sell_volume:10,primary_product_id:11111,unit_price:0.00,promotion_desc:'限时购',promotion_tag:' ',app_exclusive_price:0.00,is_app_exclusive:0,is_limited:0,is_hot:0};\n    const insertData1 = {id:(productID+1),goods_id:(id+1),goods_specification_ids:' ',goods_sn:(id+1),goods_number:Number(store),retail_price:Number(price)};\n    const insertId = await model.add(insertData);\n    const insertId1 = await this.model('product').add(insertData1);\n    const classification = await this.model('category').where({id:categoryID}).find();\n    return this.success({data:insertData,data1:insertData1,categoryName:classification.name});\n  }\n\n  async editAction() {\n    if (!this.isPost) {\n      return false;\n    }\n    const id = this.post('id');\n    const key = this.post('key');\n    const value = this.post('value');\n    const updateObject = {};\n    updateObject[key] = value;\n    if(key == 'name' || key == 'category_id' || key == 'unit' || 'primary_pic_url') {\n      const affectedRows = await this.model('goods').where({id:id}).update(updateObject);\n    }\n    else {\n      const affectedRows = await this.model('product').where({goods_id:id}).update(updateObject);\n    }\n    return this.success(updateObject);\n  }\n\n  async destroyAction() {\n    const id = this.post('id');\n    const ids = this.post('ids');\n    if(!think.isEmpty(id)) {\n      await this.model('goods').where({id: id}).limit(1).delete();\n      await this.model('product').where({goods_id:id}).limit(1).delete();\n    }\n    if(!think.isEmpty(ids)) {\n      await this.model('goods').where({id: ['in',ids]}).delete();\n      await this.model('product').where({goods_id:['in',ids]}).delete();\n    }\n\n    return this.success();\n  }\n};\n"
    ]
}