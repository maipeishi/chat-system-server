{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\api\\controller\\address.js"
    ],
    "names": [
        "Base",
        "require",
        "module",
        "exports",
        "listAction",
        "addressList",
        "model",
        "where",
        "user_id",
        "getLoginUserId",
        "select",
        "itemKey",
        "addressItem",
        "province_name",
        "getRegionName",
        "province_id",
        "city_name",
        "city_id",
        "district_name",
        "district_id",
        "full_region",
        "success",
        "detailAction",
        "id",
        "post",
        "addressInfo",
        "think",
        "isEmpty",
        "i",
        "length",
        "saveAction",
        "addressId",
        "addressData",
        "name",
        "mobile",
        "country_id",
        "address",
        "is_default",
        "max",
        "add",
        "update",
        "find",
        "deleteAction",
        "delete"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\api\\controller\\address.js",
    "sourcesContent": [
        "const Base = require('./base.js');\n\nmodule.exports = class extends Base {\n  /**\n   * 获取用户的收货地址\n   * @return {Promise} []\n   */\n  async listAction() {\n    const addressList = await this.model('address').where({user_id: this.getLoginUserId()}).select();\n    let itemKey = 0;\n    for (const addressItem of addressList) {\n      addressList[itemKey].province_name = await this.model('region').getRegionName(addressItem.province_id);\n      addressList[itemKey].city_name = await this.model('region').getRegionName(addressItem.city_id);\n      addressList[itemKey].district_name = await this.model('region').getRegionName(addressItem.district_id);\n      addressList[itemKey].full_region = addressList[itemKey].province_name + addressList[itemKey].city_name + addressList[itemKey].district_name;\n      itemKey += 1;\n    }\n\n    return this.success(addressList);\n  }\n\n  /**\n   * 获取收货地址的详情\n   * @return {Promise} []\n   */\n  async detailAction() {\n    // const addressId = this.post('id');\n    const id = this.post('id');\n\n    const addressInfo = await this.model('address').where({user_id: id}).select();\n    if (!think.isEmpty(addressInfo)) {\n      for(let i=0; i<addressInfo.length; i++) {\n        addressInfo[i].province_name = await this.model('region').getRegionName(addressInfo[i].province_id);\n        addressInfo[i].city_name = await this.model('region').getRegionName(addressInfo[i].city_id);\n        addressInfo[i].district_name = await this.model('region').getRegionName(addressInfo[i].district_id);\n        addressInfo[i].full_region = addressInfo[i].province_name + addressInfo[i].city_name + addressInfo[i].district_name;\n      }\n    }\n\n    return this.success(addressInfo);\n  }\n\n  /**\n   * 添加或更新收货地址\n   * @returns {Promise.<Promise|PreventPromise|void>}\n   */\n  async saveAction() {\n    let addressId = this.post('id');\n\n    const addressData = {\n      name: this.post('name'),\n      mobile: this.post('mobile'),\n      user_id: this.post('user_id'),\n      province_id: this.post('province_id'),\n      city_id: this.post('city_id'),\n      country_id:this.post('country_id'),\n      district_id: this.post('district_id'),\n      address: this.post('address'),\n      is_default: this.post('is_default') === true ? 1 : 0\n    };\n\n    if (think.isEmpty(addressId)) {\n      addressData.id = await this.model('address').max('id')+1\n      addressId = addressData.id\n      await this.model('address').add(addressData);\n    } else {\n      await this.model('address').where({id: addressId, user_id: this.getLoginUserId()}).update(addressData);\n    }\n\n    // 如果设置为默认，则取消其它的默认\n    if (this.post('is_default') === true) {\n      await this.model('address').where({id: ['<>', addressId], user_id: this.getLoginUserId()}).update({\n        is_default: 0\n      });\n    }\n    const addressInfo = await this.model('address').where({id: addressId}).find();\n    if (!think.isEmpty(addressInfo)) {\n        addressInfo.province_name = await this.model('region').getRegionName(addressInfo.province_id);\n        addressInfo.city_name = await this.model('region').getRegionName(addressInfo.city_id);\n        addressInfo.district_name = await this.model('region').getRegionName(addressInfo.district_id);\n        addressInfo.full_region = addressInfo.province_name + addressInfo.city_name + addressInfo.district_name;\n    }\n\n    return this.success(addressInfo);\n  }\n\n  /**\n   * 删除指定的收货地址\n   * @returns {Promise.<Promise|PreventPromise|void>}\n   */\n  async deleteAction() {\n    const addressId = this.post('id');\n\n    await this.model('address').where({id: addressId, user_id: this.getLoginUserId()}).delete();\n\n    return this.success('删除成功');\n  }\n};\n"
    ]
}