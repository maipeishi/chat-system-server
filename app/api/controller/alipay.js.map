{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\api\\controller\\alipay.js"
    ],
    "names": [
        "Base",
        "require",
        "fs",
        "axios",
        "crypto",
        "AlipaySdk",
        "default",
        "formData",
        "AlipayFormData",
        "setMethod",
        "alipaySdk",
        "gateway",
        "appId",
        "privateKey",
        "format",
        "charset",
        "alipayPublicKey",
        "sign_type",
        "module",
        "exports",
        "payAction",
        "amount",
        "post",
        "subject",
        "date",
        "Date",
        "datestr",
        "o",
        "getMonth",
        "getDate",
        "getHours",
        "getMinutes",
        "getSeconds",
        "test",
        "replace",
        "RegExp",
        "$1",
        "getFullYear",
        "substr",
        "length",
        "k",
        "th",
        "addField",
        "outTradeNo",
        "getTime",
        "toString",
        "productCode",
        "totalAmount",
        "result",
        "exec",
        "validateSign",
        "success",
        "err",
        "payParamsAction",
        "trade_status",
        "where",
        "id",
        "select",
        "signVerifyAction",
        "sign",
        "tradeNo",
        "authAppId",
        "sellerId",
        "timestamp",
        "ctx",
        "state",
        "token"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\api\\controller\\alipay.js",
    "sourcesContent": [
        "const Base = require('./base.js');\r\nconst fs = require('fs')\r\nconst axios = require('axios')\r\nvar crypto = require('crypto');\r\n\r\nconst AlipaySdk = require('alipay-sdk').default;\r\n\r\nimport AlipayFormData from 'alipay-sdk/lib/form';\r\n\r\nconst formData = new AlipayFormData();\r\nformData.setMethod('get');\r\n\r\nconst alipaySdk = new AlipaySdk({\r\n  gateway: 'https://openapi.alipaydev.com/gateway.do',\r\n  appId: '2016092000553852',\r\n  privateKey: 'MIIEpAIBAAKCAQEAsR3gcgBzA6/rpgaf1gWrO+0gzFPafv8xGX7WsPIPX0J7ucySgy0d2TS53MNzOM1EPLIr0rgE1md1wMLCspOzZmhWd+qmXA2grsEuIlEv/wG4Xoza76GHNntNBq4OVDur9qH5wklsD41s9Ccf8XK0gwHuYTjYZ6us3lC+YDSr9DAXGECUoQBe3eaU/pvpru5IEhkwX4QOtVVOc0+mN42HxYEAsFIysaf9dvF5oPhredd00pxv/ftT+HWYgzIfOgYJxJvbvkkz6GJD+RRHBZjJvlRQOAIWGeedwlMTmAeGvZp93kqfBDYcfx05QQF7Y225O0jnOwtCTBFjp7Hp9gIUaQIDAQABAoIBADihv/FTuXLVXjjA53yMZXsM0C7lJPj0aeOoDceYLlgcLulywuoUk/WuiTtQd1gTMh1iLub6lflkLV+MJqro1TUKaZOAQN8wME+QT0sDwJ/+EdCRozN5530BIdjf8I74YXzDv9NinJ3Ab7UFiY4vSg6VoH4PqgpD90tCcAzc6ppx+dMhqwYFkN4VTBXlcrei7eX8Xeg2hUm1MGES5zEyF5+JIpXAd0X0hwLrFcjehStB6/QxzvCg9sAm7qKnsYGu2OjRoEG4oW04WY+/6PdXxz3v6G23pm5L++ckNG9LbI8CtKgRRJiVByUN6DTamNpClZt2EtW636O6A0IFpStamHECgYEA1svWZYgKlQC04jnp098gLGIxmtNUPT7u/+IbZ+1Gb4pkIRNm0aHFBm7+hgehA1mB4GNpbg7R9rOgyf9Lb5A606yE4i7pATSCchdXWK7qolsk4zRwngS7sSFM4itsERk4k7wnY26mOFsSGZbTVHmHAn0O7hx4TN2ne88KviYXhFUCgYEA0xeugoRAdUSbKaJPu8+EJ3osK3abYTaMsMkwhrWSt8wUHNge6KAIiBYO3shJS8lQX3lH6JqP+sbbZOIDoz8dF6E9VY835LzeVQOfClLokRbj8mZjRq3f7A2kIplukKwZpRmM3K/kwFtyAlkD5e9ec23CXlMY1iY6z4XDojQrQ8UCgYA3iXLAw8EAr7MVPyYfOvTFpQnwXy3LvCbtkFfHskjg9CZZivutvicEN9SlcPmHtS/ohauv4jMVl3I+aDzn9qHPMy8UkE58mkgUGcbizi8qlWhfOqLXqJ+i99o6LEH/1caUJDUG94gQ0DNI3H99uwJWeWFP3ZqZPUJdt7WuXoj8FQKBgQCES3Y6JAqFtB6OZEQWT4LifuYJw0a0EUzxStXXxxoRiJweS7BrWEigiTp+kwWksqFlhIv1klCj+Vbsjd17xQVFlu7qnVyJRXkNzLwy6y0IKVFozJRxam1I8m+oo4IwtztHRpEKik4R4/26zPDtfSwzqVlEZk3NgJ4hCxNFp+5phQKBgQC22aJk5+C0ThQnKhyOGTvy4vbBjj9y2/dPyDPyMGXLcZ7NUP3bU/zUM4IL+sE3F7KjcZHOG//y2JGdsf8r1+4/Xq7Z3h+GarQdIa6f+9sgkfN1aYettqdWkPMg+W27x1AGLme1FlnFbssscO5QXoqf0WGAWuBdaypJzgFlwJElrg==',\r\n  format: 'json',\r\n  charset: 'utf-8',\r\n  alipayPublicKey: 'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsVeH7sfZNPa0iEiqe0gmWEuGkla19W9ocoW56crHnXC/XANauF5fKtjLNVqoBsHUGjU6gdA3WB/KcVFR33CASjFo2JtFGYyIGsFicEfTiPPjYs3V2b14XDpNwUkAjJf2AptMm+3oT0tXj+2cTr1tvUgNihUNHxslNyVpwKRLwGP82sU1Ym4fXICxSpdm7FrKbo3wSNy0D6uhMfSQWRiizNz6cqKTiY1aepWBvYZbRvDsuX8S83JwkgjrmuqWe3Xqd2vK2tnpsTLyF6awhIcbJxHzO7oQy9eH5NEAQg90NUsTKch0WERrN7wx1Bm1RAu4QdAyLwksbFW4V9LfmFon7wIDAQAB',\r\n  sign_type: 'RSA2'\r\n});\r\n\r\nmodule.exports = class extends Base {\r\n  async payAction() {\r\n    const amount = this.post('amount')\r\n    const subject = this.post('subject')\r\n\r\n    let date = new Date()\r\n    var datestr = 'yyyy-MM-dd hh:mm:ss'\r\n    var o = {\r\n      \"M+\": date.getMonth() + 1,                 //月份   \r\n      \"d+\": date.getDate(),                    //日   \r\n      \"h+\": date.getHours(),                   //小时   \r\n      \"m+\": date.getMinutes(),                 //分   \r\n      \"s+\": date.getSeconds(),                 //秒   \r\n    };\r\n    if (/(y+)/.test(datestr))\r\n      datestr = datestr.replace(RegExp.$1, (date.getFullYear() + \"\").substr(4 - RegExp.$1.length));\r\n    for (var k in o)\r\n      if (new RegExp(\"(\" + k + \")\").test(datestr))\r\n        datestr = datestr.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((\"00\" + o[k]).substr((\"\" + o[k]).length)));\r\n\r\nlet th = this\r\n\r\nformData.addField('returnUrl','http://192.168.10.165:9080/#/return')\r\nformData.addField('notifyUrl', 'http://47.107.155.139:8360/api/alipay/payParams');\r\nformData.addField('bizContent', {\r\n  outTradeNo: date.getTime().toString(),\r\n  productCode: 'FAST_INSTANT_TRADE_PAY',\r\n  totalAmount: amount,\r\n  subject: subject,\r\n});\r\n\r\n    try {\r\n      const result = await alipaySdk.exec(\r\n        'alipay.trade.page.pay',\r\n        {}\r\n        ,{ validateSign: true, formData:formData })\r\n\r\n      return this.success(result)\r\n    } catch (err) {\r\n      return this.success(err)\r\n    }\r\n\r\n    // return this.success(result)\r\n  }\r\n\r\n  async payParamsAction() {\r\n    const trade_status = this.post('trade_status')\r\n    if(!trade_status)\r\n      await this.module('order').where({id:trade_status}).select()\r\n    return this.success('success')\r\n  }\r\n\r\n  async signVerifyAction() {\r\n    const sign = this.post('sign')\r\n    const tradeNo = this.post('tradeNo')\r\n    const appId = this.post('appId')\r\n    const authAppId = this.post('authAppId')\r\n    const outTradeNo = this.post('outTradeNo')\r\n    const sellerId = this.post('sellerId')\r\n    const timestamp = this.post('timestamp')\r\n    const totalAmount = this.post('totalAmount')\r\n\r\n    \r\n\r\n  \r\n  \r\n// var signature = decodeURIComponent(sign,'base64')\r\n    // var verifier = crypto.createSign('RSA-SHA256');\r\n    // const private_key = fs.readFileSync('./app_private_key.pem') \r\n    // var info = 'app_id='+appId+'&auth_app_id'+authAppId+'&charset=utf-8&method=alipay.trade.page.pay.return&out_trade_no='+outTradeNo+'&seller_id='+sellerId+'&timestamp='+timestamp+'&total_amount='+totalAmount+'&trade_no='+tradeNo+'&version=1.0';\r\n    // verifier.update(info) \r\n    // var signOrder = encodeURIComponent(verifier.sign(private_key, 'base64'))\r\n    // let result = verifier.verify('-----BEGIN PUBLIC KEY-----/nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsVeH7sfZNPa0iEiqe0gmWEuGkla19W9ocoW56crHnXC/XANauF5fKtjLNVqoBsHUGjU6gdA3WB/KcVFR33CASjFo2JtFGYyIGsFicEfTiPPjYs3V2b14XDpNwUkAjJf2AptMm+3oT0tXj+2cTr1tvUgNihUNHxslNyVpwKRLwGP82sU1Ym4fXICxSpdm7FrKbo3wSNy0D6uhMfSQWRiizNz6cqKTiY1aepWBvYZbRvDsuX8S83JwkgjrmuqWe3Xqd2vK2tnpsTLyF6awhIcbJxHzO7oQy9eH5NEAQg90NUsTKch0WERrN7wx1Bm1RAu4QdAyLwksbFW4V9LfmFon7wIDAQAB/n-----END PUBLIC KEY-----', signature, 'base64');\r\n    //return this.success({result:result,userToken:this.ctx.state.token})\r\n    return this.success(this.ctx.state.token)\r\n  }\r\n}"
    ]
}